{% extends "admin/admin_menu.html" %}
{% block title %}Dictionaries{% endblock %}
{% block admin_content %}
{# Dictionary model:

class Label(db.EmbeddedDocument):
    language: tools.Language = db.ReferenceField('tools.Language', primary_key=True)
    label: str = db.StringField(max_length=255, required=True)

class Description(db.EmbeddedDocument):
    language: tools.Language = db.ReferenceField('tools.Language', primary_key=True)
    description: str = db.StringField(required=True)

class LabelManager:
    name: str = db.StringField(max_length=255, required=True)
    _labels: list[_types.Label] = db.ListField(db.EmbeddedDocumentField(_types.Label, unique=True), default=[])
    
    def label(self, language: Language | None = None) -> str:
        ln_code = language.code if language else 'en'
        for l in self._labels:
            if l.language.code == ln_code:
                return l.label
        return self.name.capitalize()
    
    def set_label(self, language: Language, label: str, save: bool = True):
        for l in self._labels:
            if l.language == language:
                l.label = label
                if save: self.save()
                return self
        self._labels.append(_types.Label(language=language, label=label))
        if save: self.save()
        return self
    
    def remove_label(self, language: Language, save: bool = True):
        for l in self._labels:
            if l.language == language:
                self._labels.remove(l)
                if save: self.save()
        return self

class DescriptionManager:
    _descriptions: list[_types.Description] = db.ListField(db.EmbeddedDocumentField(_types.Description), default=[])
    
    def description(self, language: Language | None = None) -> str:
        ln_code = language.code if language else 'en'
        for d in self._descriptions:
            if d.language.code == ln_code:
                return d.description
        return ''
    
    def set_description(self, language: Language, description: str, save: bool = True):
        for d in self._descriptions:
            if d.language == language:
                d.description = description
                if save: self.save()
                return self
        self._descriptions.append(_types.Description(language=language, description=description))
        if save: self.save()
        return self
    
    def remove_description(self, language: Language, save: bool = True):
        for d in self._descriptions:
            if d.language == language:
                self._descriptions.remove(d)
                if save: self.save()
        return self

class Dictionary(db.Document, LabelManager, DescriptionManager):
    meta = {'abstract': True, 'allow_inheritance': True, 'ordering': ['name'], 'indexes': ['name', 'code']}
    active: bool = db.BooleanField(default=True, required=True)
    name: str = db.StringField(max_length=255, required=True)
    code: str = db.StringField(max_length=255, primary_key=True, required=True)
    
    def __unicode__(self) -> str:
        return str(self.name).capitalize()

class Language(Dictionary): code: str = db.StringField(max_length=2, primary_key=True)

dictionaries = [{
	'name': ..., # Dictionary name
	'objects': [...], # List of dictionary objects
}, ...]

#}
<script type="module">
	import '{{ url_for('public.module', path='@polymer/iron-form/iron-form.js') }}';
	import '{{ url_for('public.module', path='@polymer/paper-checkbox/paper-checkbox.js') }}';
	import '{{ url_for('public.module', path='@polymer/paper-input/paper-input.js') }}';
	import '{{ url_for('public.module', path='@polymer/paper-button/paper-button.js') }}';
</script>
<div class="row clearfix no-margin no-padding">
	<div class="col-md-12">
		<ul class="nav nav-tabs nav-justified" role="tablist">
			{% for d in dictionaries %}
			<li class="nav-item clearfix no-margin no-padding {% if loop.first %}active{% endif %}" role="presentation">
				<a href="#{{ d.name }}" class="nav-link" data-toggle="tab" role="tab">{{ d.name }}</a>
			</li>
			{% endfor %}
		</ul>
		<div class="tab-content">	
			{% for d in dictionaries %}
				<div class="tab-pane clearfix no-margin no-padding {% if loop.first %}active{% endif %}"
				id="{{ d.name }}" role="tabpanel">
					<table class="table">
						<thead>
							<tr>
								<th>Code</th>
								<th>Name</th>
								<th>Label</th>
								<th>Description</th>
								<th>Active</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							{# Add new object (long button, if clicked, it will replace the button with a form) #}
							<tr>
								<td colspan="6">
									{# <button class="btn btn-primary btn-block" type="button"
									onclick="this.style.display = 'none'; this.nextElementSibling.style.display = 'block';"
									>Add new {{ d.name }}</button> #}
									<paper-button class="btn btn-primary btn-block" type="button"
									onclick="this.style.display = 'none'; this.nextElementSibling.style.display = 'block';"
									>Add new {{ d.name }}</paper-button>
									<iron-form id="new-{{ d.name }}" style="display: none;">
										<form method="post" action="{{ pass }}">
											<paper-input name="code" label="Code" required></paper-input>
											<paper-input name="name" label="Name" required></paper-input>
											<paper-input name="label" label="Label" required></paper-input>
											<paper-input name="description" label="Description" required></paper-input>
											<paper-checkbox name="active" checked>Active</paper-checkbox>
											{# <button class="btn btn-primary" type="submit">Add</button>
											<button class="btn btn-secondary" type="button" #}
											<paper-button raised class="indigo" type="submit">Add</paper-button>
											<paper-button raised class="indigo" type="button"
											onclick="this.parentElement.parentElement.style.display = 'none';
											this.parentElement.parentElement.previousElementSibling.style.display = 'block';"
											>Cancel</button>
										</form>
									</iron-form>
								</td>
							</tr>
							{% for o in d.objects %}
							<tr>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			{% endfor %}
		</div>
	</div>
</div>
{% endblock %}